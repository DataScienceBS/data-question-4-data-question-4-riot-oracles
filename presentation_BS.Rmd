---
title: "Riot Oracles"
author: "Justin, Smita, and Brandon"
date: "2/3/2018"
output:
    html_document:
      toc: true
---

```{r reading_data, include=FALSE}
knitr::opts_chunk$set(include = TRUE)
combined_df <- readRDS("combined_df.RDS")
merged_df <- readRDS("merged_df.RDS")
school_cross <- readRDS("school_cross.RDS")
```

```{r libraries, include=FALSE}
library(ggplot2)
library(dplyr)
library(knitr)
library(tidyr)
library(PerformanceAnalytics)  
library(maps)
library(mapdata)
library(mapproj) 
library(ggmap)
library(plotly)
library(GGally)
library(corrplot)
library(MASS)
library(tidyverse)
library(gapminder)
```

## Data and Approach
We used IRS tax data for the state of Tennessee to review income levels by zip code, along with other financial variables, to find correlation with county level school data. We analyzed school and tax data separately, as well as their influence on each other. The data sources for our research have been included in our [Sources Cited](#sources-cited).   
  
![](https://www.tn.gov/content/dam/tn/education/images/CORE-districts.png)
  
## Cleaning the Data
Some school districts reported a graduation rate of 0%. Obviously, this is not accurate, and were likely empty values. We removed this data as to not influence the averages per CORE Region. We also identified instances where county data did not map exactly between tax and shool data. We were able to leverage the zip code crosswalk to join these datasets, as well as some data cleansing to ensure DeKalb County was properly recognized. 

## Research  
[School Funding, Taxes, and Economic Growth, _An Analysis of the 50 States_](http://www.nea.org/assets/docs/HE/schoolfunding.pdf), was part of our research.  
--- add Smita's research paper
--- increase funding by 2% increased performance 

[Dual Enrollment for TN School Districts](https://www.ingramcontent.com/news/dual-enrollment-made-more-accessible-for-tennessee-school-districts)  

#### SMITA ---- Enrollment, Graduation, Ethnicity, 
```{r Smita_grad_rate_and_expense}

#smita_df <- readRDS("smita.RDS")


```



## Our Observations


########################
#### chloropleth maps
#### insert avg AGI
#### insert avg ACT Composite
########################
#### insert ACT by region (boxplot)
########################
#### Graduation Rates by Region
#### 
########################
  
     
Shown below is the average ACT Composite Score by zip code, colored by AGI Range, with the x-axis showing the ratio of AGI per range. As shown at the highest ACT Score of the Mid Cumberland Core, we see an ACT Composite Score of 23.8. With such a tight grouping of ratio by AGI, the income for this zip code appears to be closer across AGI ranges. Closer investigation shows this zip code is vastly different from most other zip codes - the AGI Range of $1 to $25,000 has the lowest ratio of all zip codes at this y-axis.  
  
```{r ACT_agi, echo=FALSE, message=FALSE, warning=FALSE}
p <- combined_df %>% 
  filter(zip_code != 0 | zip_code != 99999) %>% 
  filter(agi_range != 'Total') %>% 
  filter(CORE_region != 'NA') %>% 
  #  group_by(agi_range) %>% 
  ggplot(., aes(x=ratio_by_agi, y=ACT_Composite, color=agi_range)) +
  geom_point() 

p <-  p + facet_grid(. ~ CORE_region)

p <- ggplotly(p, width=1500, height=500)
p
```
  
```{r test_plotly, echo=FALSE, message=FALSE, warning=FALSE, paged.print=FALSE}
#plot_ly(combined_df, y = ~ACT_Composite, x = ~ratio_by_agi, color = ~agi_range,
#                   type = 'scatter',
#                   mode = 'markers',
#                   alpha = 0.3,
#                   text = ~paste('Zip Code: ', zip_code,
#                                 '<br> System Name: ', system_name))
```
Southwest Memphis Core seems to have more variation in ACT Composite scores than any other region in the state. 
  
```{r act_by_core, echo=FALSE, warning=FALSE}
box <- combined_df %>% 
  filter(zip_code != 0 | zip_code != 99999) %>% 
  filter(agi_range != 'Total') %>% 
  filter(CORE_region != 'NA') %>% 
  filter(ACT_Composite != 'NA') %>% 
  ggplot(., aes(x=CORE_region, y=ACT_Composite)) +
  geom_boxplot() +
  theme(axis.text.x = element_text(angle = 60, hjust = 1))

box
```

### Including Plots  
```{r ACT_county_map, include=FALSE}
library(maps)
library(mapdata)  #preloaded state/county coordinates
color_df <- readRDS("color_df.RDS")


TN_map <- ggplot() +
  geom_polygon(data = color_df,
               aes(x = long, y = lat, group = group, fill = Average_ACT_Composite),
               color = "white", size = 0.25) +
  coord_map() +
  scale_fill_distiller(name="ACT Scores", palette = "YlGn") +
  theme_nothing(legend = TRUE) +
  labs(title = "Average ACT Composite Scores by County")
```
   
```{r map_ACT, echo=FALSE}
TN_map
```   
  
### Grades Matter!   

Using data from the state achievement scores, we were able to accurately predict the average ACT scores for a county given the proficiency rates of four key subject categories: **Algebra I**, **Chemistry**, **Math**, and **ELA**. Using DeKalb County as a test county, we trained a prediction model on the other 94 counties in Tennessee and we able to predict DeKalb's ACT Composite score of 19.1.  
_lm(formula = ACT_Composite ~ AlgI + Chemistry + Math + ELA, data = school_cross_no_dekalb_no_outliers)_  

View(school_cross)
## Sources Cited

### Packages Used
*  readxl  
*  ggplot2  
*  knitr  
*  dplyr  
*  tidyr  
*  PerformanceAnalytics  
*  maps  
*  mapdata  
*  mapproj  
*  ggmap  

### Data Links  
*  [IRS Sales Tax Data](https://www.irs.gov/statistics/soi-tax-stats-individual-income-tax-statistics-zip-code-data-soi)    
*  [School Achievement Data](https://www.tn.gov/education/data/data-downloads.html)   
*  [Crosswalk, Zip to District](https://www.tn.gov/education/data/data-downloads.html)  
*  [Department of Education, Data Definitions](https://www.tn.gov/content/dam/tn/education/data/data_definitions.pdf)  